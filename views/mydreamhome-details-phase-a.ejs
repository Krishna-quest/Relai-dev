<%- include('dashboard_header')-%>
  <%- include('edit-profile-model')-%>
    <!-- The Modal -->
    <div class="modal permission-modal fade " id="myModal">
      <div class="modal-dialog">
        <div class="modal-content">

          <!-- Modal Header -->
          <div class="modal-header text-center">
            <h2 class="modal-title w-100">Raise a Complaint</h2>
          </div>

          <!-- Modal body -->
          <div class="modal-body">
            <select class="form-control " id="selectBox">
              <option value="0">Select professional</option>
              <option value="">2</option>
            </select>

            <input type="text" class="form-control  form-control-fix2" id="subject" placeholder="Subject"
              name="subject">
            <textarea class="form-control  form-control-fix2" rows="3" id="comment">Add Notes</textarea>

            <div class="model-btn-fix">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-cancel" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-cancel" data-dismiss="modal">Submit</button>
          </div>
        </div>
      </div>
    </div>
    <div class="dashboard-wpr">
      <div class="container-fluid">
        <div class="row content">
          <div class="col-sm-2 sidenav hidden-xs-down">
            <div class="user-login text-center">

              <%- include('profile-image')-%>

                <div class="user-name">
                  <h2>
                    <%= session.name %>
                  </h2>
                  <a href="#">
                    <%= session.email %>
                      <%- include('edit-profile-icon')-%>
                  </a>
                </div>
            </div>
            <%- include('sidebar')-%>
          </div>
          <div class="col-sm-12 col-lg-10">
            <div class="dashboard-inner">
              <div class="row">
                <div class="breadcumb">
                  <ul>
                    <li><a href="/mydreamhome-details" onclick="location.href=this.href+'?id='+scrt_var;return false;"><i
                          class="fa fa-long-arrow-left" aria-hidden="true" id="backtodeatils"></i> Back
                        to <%=propertyData.ps_property_name%></a>
                    </li>

                  </ul>
                </div>
              </div>
              <div class="todo-list-table">
                <div class="clearfix">
                  <div class="heading-top float-left">
                    <input type="hidden" class="phsename" value="<%=phase%>">
                    <h2>
                      <%=propertyData.ps_property_name%> <i class="fa fa-long-arrow-left" aria-hidden="true"></i> Phase
                      <%=step%> :<%=phase%>
                    </h2>
                  </div>
                  <div class="total-time-cost float-right">
                    <div class="total-time"><a href="#">TOTAL TIME<br><span>525 days</span></a></div>
                    <div class="total-time"><a href="#">TOTAL COST<br><span>100,000 ï¿¡</span></a></div>
                  </div>
                </div>
                <div class="phase-progress">
                  <ul>
                    <li><a href="javascript:void(0)">25%</a></li>
                    <li><a href="javascript:void(0)">25%</a></li>
                    <li><a href="javascript:void(0)">25%</a></li>
                    <li><a href="javascript:void(0)">25%</a></li>
                  </ul>
                </div>
                <div class="action-owner">
                  <div class="clearfix">
                    <div class="float-left">
                      <p>Action</p>
                    </div>
                    <div class="float-left">
                      <p>Action Owners</p>
                    </div>
                    <% if(session.active_user_login=='buyer' ){%>
                      <div class="float-right">
                        <a href="#" class="add-professionals" data-toggle="modal" data-target="#buyerPhaseA">Add
                          Existing Task</a>
                      </div>
                      <%} else if(session.active_user_login=='seller' ){%>
                        <div class="float-right">
                          <a href="#" class="add-professionals" data-toggle="modal" data-target="#sellerPhaseA">Add
                            Existing Task</a>
                        </div>
                        <%} else {%>
                          <div class="float-right">
                            <a href="#" class="add-professionals" data-toggle="modal" data-target="#renovatorPhaseA">Add
                              Existing Task</a>
                          </div>
                          <%}%>
                            <div class="float-right">
                              <a href="#" class="add-professionals" data-toggle="modal" data-target="#addTask">Add
                                Task</a>
                            </div>

                  </div>
                </div>
                <table class="table table-responsive table-phase-fix-2">
                  <thead>
                    <tr>
                      <th>Task</th>
                      <th>Buyer</th>
                      <th>Solicitor</th>
                      <%if(hiredProfessional_list.length>0){%>
                        <%hiredProfessional_list.forEach(function(row,i){%>
                      <th><%=row.sps_fullname%></th>
                      <!-- <th>Professional B</th>
                      <th>Professional C</th> -->
                      <%})%>
                      <%}else{%>
                        <th>Professional NA</th>
                        <%}%>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody>
                    <%if(taskObject.length==0){%>
                      <tr>
                        <td>Result Not Found</td>
                      </tr>
                      <%}else{%>
                        <%taskObject.forEach(function(row,i){%>
                          <tr>
                            <td> <label class="check-todos">
                                <p>
                                  <%=row.ppts_task_name%>
                                </p>

                                <input type="checkbox">
                                <span class="checkmark"></span>
                              </label></td>

                            <td><a href="#" class="upload-any"><img src="images/upload.png">
                                <span>
                                  <div class="custom-file-input">
                                    <input type="file">
                                    <input type="button">
                                  </div>
                                </span>
                              </a>
                              <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                            </td>
                            <td><a href="#" class="upload-any"><img src="images/upload.png">
                                <span>
                                  <div class="custom-file-input">
                                    <input type="file">
                                    <input type="button">
                                  </div>
                                </span>
                              </a>
                              <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                            </td>
                            <%if(hiredProfessional_list.length>0){%>
                              <%hiredProfessional_list.forEach(function(row,i){%>
                            <td><a href="#" class="upload-any"><img src="images/upload.png">
                                <span>
                                  <div class="custom-file-input">
                                    <input type="file">
                                    <input type="button">
                                  </div>
                                </span>
                              </a>
                              <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                            </td>
                            <%});%>
                            <%}%>
                            <!-- <td><a href="#" class="upload-any"><img src="images/upload.png">
                                <span>
                                  <div class="custom-file-input">
                                    <input type="file">
                                    <input type="button">
                                  </div>
                                </span>
                              </a>
                              <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                            </td> -->
                            <!-- <td><a href="#" class="upload-any"><img src="images/upload.png">
                                <span>
                                  <div class="custom-file-input">
                                    <input type="file">
                                    <input type="button">
                                  </div>
                                </span>
                              </a>
                              <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                            </td> -->
                            <td><a class="btn help-btn" href="#" data-toggle="modal" data-target="#myModal">Help</a>
                            </td>
                            <td><i class="fa fa-pencil editbtn" data-toggle="modal"
                                data-target="#todoNotesModal<%=row._id%>"></i></td>
                            <td>
                              <div id="todoNotesModal<%=row._id%>" class="modal fade" role="dialog">
                                <div class="modal-dialog">
                                  <div class="modal-content">
                                    <div class="modal-header">
                                      <button type="button" class="close" data-dismiss="modal">&times;</button>

                                    </div>
                                    <div class="modal-body">
                                      <p>
                                        <%=row.ppts_note%>
                                      </p>
                                    </div>
                                    <div class="modal-footer">
                                      <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    </div>
                                  </div>

                                </div>
                              </div>
                            </td>
                          </tr>
                          <%});%>
                            <%}%>
                              <!-- <tr>
                      <td><label class="check-todos">
                          <p>Instruct other professionals</p>
                          <input type="checkbox">
                          <span class="checkmark"></span>
                        </label></td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a class="btn help-btn" href="#" data-toggle="modal" data-target="#myModal">Help</a></td>
                    </tr>
                    <tr>
                      <td><label class="check-todos">
                          <p>ID/Passport</p>
                          <input type="checkbox">
                          <span class="checkmark"></span>
                        </label></td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a class="btn help-btn" href="#" data-toggle="modal" data-target="#myModal">Help</a></td>
                    </tr>
                    <tr>
                      <td><label class="check-todos">
                          <p>Proof of address</p>
                          <input type="checkbox">
                          <span class="checkmark"></span>
                        </label></td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a class="btn help-btn" href="#" data-toggle="modal" data-target="#myModal">Help</a></td>
                    </tr>
                    <tr>
                      <td><label class="check-todos">
                          <p>Proof of fund (cash buyers)/agreement in principle (mortgage)</p>
                          <input type="checkbox">
                          <span class="checkmark"></span>
                        </label></td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a href="#" class="upload-any"><img src="images/upload.png">
                          <span>
                            <div class="custom-file-input">
                              <input type="file">
                              <input type="button">
                            </div>
                          </span>
                        </a>
                        <a href="/professionals-detail-message"><img src="images/chat.png"></a>
                      </td>
                      <td><a class="btn help-btn" href="#" data-toggle="modal" data-target="#myModal">Help</a></td>
                    </tr> -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    </div>




    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <!-- <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
    integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
    crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10/dist/sweetalert2.min.js"></script>
    <script>
      $(document).ready(function () {
        $(".sidenav ul li").click(function () {
          $(".sidenav ul li").removeClass("active");
          $(this).addClass("active");
        });
      });
      $(document).ready(function () {
        $(".right-navbar li").click(function () {
          $("right-navbar li").removeClass("active");
          $(this).addClass("active");
        });
      });
    </script>
    <script>

      $(document).ready(function () {
        // var url  = window.location.href;
        // alert(url)
        //  $('#backtodeatils').click(function(){
        //   $(this).prop("href", "http://www.jakcms.com")
        //  })
        // function getParameterByName(name, url) {
        //   if (!url) url = window.location.href;
        //   name = name.replace(/[\[\]]/g, "\\$&");
        //   var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
        //     results = regex.exec(url);
        //   if (!results) return null;
        //   if (!results[2]) return '';
        //   return decodeURIComponent(results[2].replace(/\+/g, " "));
        // }
        // var val = getParameterByName('id');
        // alert(val)
        // var loc = "mydreamhome-details?id="+val; 
        // document.write('<a href="' + loc + '">Google</a>'); 
        // $("#backtodeatils").attr("href", "mydreamhome-details?id="+id);
      });

    </script>
    <script language="javascript" type="text/javascript">
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }
      var val = getParameterByName('id');
      //alert(val)
      var scrt_var = val; 
    </script>

    <script>
      $(document).ready(function () {
        $(".buyertab").click(function (e) {
          $.ajax({
            type: "GET",
            url: "/buyer",
            cache: false,
            success: function (html) {
            }
          });
          location.reload(true);
        });
        $(".sellertab").click(function (e) {
          $.ajax({
            type: "GET",
            url: "/seller",
            cache: false,
            success: function (html) {
            }
          });
          location.reload(true);
        });
        $(".renovatortab").click(function (e) {
          $.ajax({
            type: "GET",
            url: "/renovator",
            cache: false,
            success: function (html) {
            }
          });
          location.reload(true);
        });
      });
    </script>
   <script>

    $(document).ready(function () {
      $(".add-professionals").click(function (e) {
        $.ajax({
          type: "GET",
          url: "/api/addTask",
          cache: false,
          success: function (data) {
            console.log(data)
            var htmlData = '';
            $(".ppts_property_id").val(data.property_id);
            var phasename=$('.phsename').val()
            //alert(phasename)
            $('.ppts_phase_name').val(phasename)
            htmlData += '<option value="">Select Hired professional</option>';
            if (data.data.length > 0) {
              $.each(data.data, function (i, data) {
                console.log('val:', data)
                htmlData += '<option value="' + data._id + '">' + data.sps_fullname + '</option>';
              });
            }
            $('.add_task_mydreamhome_detial_phase').html(htmlData);
          }
        });
      })
      $(".cancel_task_btn").click(function(e){
        $('#ppts_task_name,#ppts_note,#ppts_due_date').val('');
      })
      $("#add_task_submit_form").on('submit', function (e) {
       
        e.preventDefault();
        var formData = $("#add_task_submit_form").serialize();

        if (formData) {
          $.ajax({
            type: "POST",
            data: formData,
            url: "/api/addTask_from_Dreamhome_detial_phase",
            cache: false,
            success: function (data) {
              if (data.status == false) {

                Swal.fire({
                  // position: 'top-end',
                  icon: 'error',
                  title: data.err_msg,
                  showConfirmButton: true,
                  confirmButtonColor: '#005377'
                  //timer: 1500
                })


              } else {

                console.log('meserrmessagesage:', data.success_msg)


                Swal.fire({
                  // position: 'top-end',
                  icon: 'success',
                  title: data.success_msg,
                  showConfirmButton: false,
                  confirmButtonColor: '#005377',
                  timer: 3000
                })
                location.reload(true)
                $('#ppts_task_name,#ppts_note,#ppts_due_date').val('');


              }

            }
          });

        } else {
          alert('some thing wrong')
        }
      })
      //buyer==================
      $(".cancel_existing_task_btn").click(function(e){
        $('#notes,#duedate').val('');
      })
      $("#Add_existing_task_form").on('submit', function (e) {
        e.preventDefault()
        //alert('1')
        var formData = $("#Add_existing_task_form").serialize();
        console.log(formData)
        if (formData) {
          $.ajax({
            type: "POST",
            data: formData,
            url: "/api/Add_existing_task_from_Dreamhome_detial_phase",
            cache: false,
            success: function (data) {
              if (data.status == false) {

                Swal.fire({
                  // position: 'top-end',
                  icon: 'error',
                  title: data.err_msg,
                  showConfirmButton: true,
                  confirmButtonColor: '#005377'
                  //timer: 1500
                })


              } else {

                console.log('meserrmessagesage:', data.success_msg)


                Swal.fire({
                  // position: 'top-end',
                  icon: 'success',
                  title: data.success_msg,
                  showConfirmButton: false,
                  confirmButtonColor: '#005377',
                  timer: 3000
                })
                location.reload(true)
                $('#notes,#duedate').val('');


              }

            }
          });

        } else {
          alert('some thing wrong')
        }
      })
      //buyer end===============
      //seller existing ==========
      $("#Add_existing_task_form_sellerPhaseA").on('submit', function (e) {
        e.preventDefault()
        //alert('seller A')
        var formData = $("#Add_existing_task_form_sellerPhaseA").serialize();
        console.log(formData)
        //return;
        if (formData) {
          $.ajax({
            type: "POST",
            data: formData,
            url: "/api/Add_existing_task_from_Dreamhome_detial_phase",
            cache: false,
            success: function (data) {
              if (data.status == false) {

                Swal.fire({
                  // position: 'top-end',
                  icon: 'error',
                  title: data.err_msg,
                  showConfirmButton: true,
                  confirmButtonColor: '#005377'
                  //timer: 1500
                })


              } else {

                console.log('meserrmessagesage:', data.success_msg)


                Swal.fire({
                  // position: 'top-end',
                  icon: 'success',
                  title: data.success_msg,
                  showConfirmButton: false,
                  confirmButtonColor: '#005377',
                  timer: 3000
                })
                location.reload(true)
                $('#notes,#duedate').val('');


              }

            }
          });

        } else {
          alert('some thing wrong')
        }
      })
      //seller existing end=============
      //renoverot existing start=========
      $("#Add_existing_task_form_renovatorPhaseA").on('submit', function (e) {
        e.preventDefault()
        //alert('renovetor A')
        var formData = $("#Add_existing_task_form_renovatorPhaseA").serialize();
        console.log(formData)
        //return;
        if (formData) {
          $.ajax({
            type: "POST",
            data: formData,
            url: "/api/Add_existing_task_from_Dreamhome_detial_phase",
            cache: false,
            success: function (data) {
              if (data.status == false) {

                Swal.fire({
                  // position: 'top-end',
                  icon: 'error',
                  title: data.err_msg,
                  showConfirmButton: true,
                  confirmButtonColor: '#005377'
                  //timer: 1500
                })


              } else {

                console.log('meserrmessagesage:', data.success_msg)


                Swal.fire({
                  // position: 'top-end',
                  icon: 'success',
                  title: data.success_msg,
                  showConfirmButton: false,
                  confirmButtonColor: '#005377',
                  timer: 3000
                })
                location.reload(true)
                $('#notes,#duedate').val('');


              }

            }
          });

        } else {
          alert('some thing wrong')
        }
      })
      //renovetor end============
    })
  </script>

    </body>

    </html>